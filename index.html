<!DOCTYPE html>
<html lang="it">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Favicon -->
    <link rel="icon" href="../img/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="2160x2160" href="../img/GSecurityLogo.png">
    <title>Cripto Example</title>
    <script src="https://code.jquery.com/jquery-3.7.0.js"
        integrity="sha256-JlqSTELeR4TLqP0OG9dxM7yDPqX1ox/HfgiSLBj8+kM=" crossorigin="anonymous"></script>
    <!-- librerie esterne -->
    <script src="extension/seedrandom.js"></script>
    <script src="extension/jsSHA.js"></script>
    <script src="extension/funzioni.js"></script>
    <!-- --- -->
    <script src="cipher.js" type="module"></script>
    <script src="script.js" type="module"></script>
    <script src="../js/script.js"></script>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="style.css">
    <!-- highlight codice -->
    <script src="https://projectsx.altervista.org/js/syntaxHighlight.js"></script>
    <link href="https://projectsx.altervista.org/css/default.css" rel="stylesheet">
</head>

<body>
    <div id="app">
        <section class="glass-container tester">
            <h1>Test Tool</h1>
            <div class="btn-container">
                <button type="button" class="btn" id="test_btn">
                    Esegui un test
                </button>
            </div>
            <div class="sezione" id="genera_chiave">
                <h2>Genera Chiavi Casuali</h2>
                <label for="l_chiave">Bit Chiave</label>
                <select class="input" title="Lunghezza chiave in BIT" name="l_chiave" id="l_chiave">
                    <option value="32">32</option>
                    <option value="64">64</option>
                    <option value="128" selected>128</option>
                    <option value="256">256</option>
                    <option value="512">512</option>
                    <option value="1024">1024</option>
                </select>
                <label for="chiave">Chiave (esadecimale)</label>
                <textarea class="input" type="text" id="chiave" rows="4" cols="50" placeholder="chiave"
                    disabled></textarea>
                <div class="btn-container">
                    <button title="Genera chiave casuale" type="button" class="btn" id="genera_chiave_casuale">Genera
                        Chiave Casuale</button>
                    <button type="button" class="btn text copy_value check_animation" data-target="chiave"
                        title="Copia Password">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                            stroke="currentColor" class="w-6 h-6">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184">
                            </path>
                        </svg>
                    </button>
                </div>
                <hr>
                <h2>Utilizza questa libreria</h2>
<pre class="glass-container"><code data-lang="html">&lt;script src="https://shorturl.at/vyHJW"&gt;&lt;/script&gt;
&lt;script src="https://shorturl.at/vHINS"&gt;&lt;/script&gt;
&lt;script src="https://shorturl.at/dHJQU"&gt;&lt;/script&gt;
&lt;script src="https://shorturl.at/DLR68" type="module"&gt;&lt;/script&gt;</code></pre>
            </div>
            <!-- 
                Cifra
             -->
            <div class="sezione" id="sezione_cifra" style="display: none">
                <h2>Cifra</h2>
                <label for="testo_cifra">Testo</label>
                <textarea type="text" class="input" rows="4" cols="50" id="testo_cifra"
                    placeholder="Testo cifrato"></textarea>
                <span class="btn-spawn" data-target="testo_cifra"></span>
                <!-- --- -->
                <label for="chiave_cifra">Chiave HEX</label>
                <textarea type="text" class="input" rows="4" cols="50" id="chiave_cifra"
                    placeholder="Chiave HEX"></textarea>
                <span class="btn-spawn" data-target="chiave_cifra"></span>
                <!-- --- -->
                <button title="Converti" type="button" id="btn-cifra" class="btn">Cifra</button>
                <!-- --- -->
                <p title="Clicca per copiare" class="glass-container" id="d1"></p>
                <button type="button" class="btn text copy_text check_animation" data-target="d1"
                    title="Copia Testo Cifrato">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184">
                        </path>
                    </svg>
                </button>
            </div>
            <!-- 
                Decifra
             -->
            <div class="sezione" id="sezione_decifra" style="display: none">
                <h2>Decifra</h2>
                <label for="testo_decifra">Testo Cifrato</label>
                <textarea type="text" class="input" rows="4" cols="50" id="testo_decifra"
                    placeholder="Testo cifrato"></textarea>
                <span class="btn-spawn" data-target="testo_decifra"></span>
                <!-- --- -->
                <label for="chiave_decifra">Chiave HEX</label>
                <textarea type="text" class="input" rows="4" cols="50" id="chiave_decifra"
                    placeholder="Chiave HEX"></textarea>
                <span class="btn-spawn" data-target="chiave_decifra"></span>
                <!-- --- -->
                <button title="Converti" type="button" id="btn-decifra" class="btn">Decifra</button>
                <!-- --- -->
                <p title="Clicca per copiare" class="glass-container" id="d2"></p>
                <button type="button" class="btn text copy_text check_animation" data-target="d2"
                    title="Copia Testo Decifrato">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                        stroke="currentColor" class="w-6 h-6">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184">
                        </path>
                    </svg>
                </button>
            </div>
            <!-- 
                Codice Sorgente
             -->
            <div class="sezione" id="sezione_codice_sorgente" style="display:none">
<pre class="glass-container" id="codice_cipher"><code data-lang="js">import { OperazioniLogiche } from './class/OperazioniLogiche.js';
import { Codifica } from './class/Codifica.js';
import { OperazioniCrittografiche } from './class/OperazioniCrittografiche.js';
import { Hash } from './class/Hash.js';
import { Sbox } from './class/Sbox.js';

export class Cipher {
    constructor(rounds = 24) {
        this.blocchi = 128;
        this.rounds = rounds;
        this.logica = new OperazioniLogiche();
        this.str = new Codifica();
        this.cripto = new OperazioniCrittografiche();
        this.hash = new Hash();
        this.sbox = new Sbox();
    }
    /**
     * Cifra del testo
     * @param {*} testo stringa
     * @param {*} chiave in formato esadecimale
     */
    cifra(testo, chiave) {
        // inizializzo le variabili
        testo = this.str.utf8_(testo).binario_().string();
        const chiavi = this.cripto.get_3_key(chiave);
        // XOR
        testo = this.xor(testo, chiavi[0]);
        // SBOX
        this.sbox.genera_sbox(chiavi[0]);
        testo = this.sbox.sostituzione_completa(testo, false);
        // LENGTH BLOCCHI NULLI
        const lunghezza_blocchi_nulli = this.cripto.blocks(testo, this.blocchi).len;
        // ROUND
        let chiave_round = chiavi[1];
        // ---
        for (let i = 0; i < this.rounds; i++) {
            // CHIAVE
            const nuova_chiave = this.chiave_round(chiave_round, i);
            chiave_round = nuova_chiave.binario;
            // SBOX
            this.sbox.genera_sbox(chiave_round);
            testo = this.sbox.sostituzione_completa(testo, false);
            // ---
            testo = this.round(testo, chiave_round, false);
        }
        // SBOX
        this.sbox.genera_sbox(chiavi[2]);
        testo = this.sbox.sostituzione_completa(testo, false);
        // XOR
        testo = this.xor(testo, chiavi[2]);
        // ultime operazioni
        testo = this.cripto.ultima_fase(testo, lunghezza_blocchi_nulli);
        return testo;
    }
    /**
     * Decifra del testo
     * @param {*} testo stringa base 64
     * @param {*} chiave in formato esadecimale
     */
    decifra(testo, chiave) {
        const testo_bits = this.cripto.split_testo_decifrato(testo);
        const null_bits = parseInt(this.str._hex(testo_bits.bit.match(/\d+/g).join('')).string());
        testo = completa_base_64(testo_bits.testo);
        // inizializzo le variabili
        testo = this.str._base64(testo).binario_().string();
        const chiavi = this.cripto.get_3_key(chiave);
        // XOR
        testo = this.xor(testo, chiavi[2]);
        // SBOX
        this.sbox.genera_sbox(chiavi[2]);
        testo = this.sbox.sostituzione_completa(testo, true);
        // ROUND
        let chiave_round = chiavi[1];
        // pre calcola le chiavi
        const chiavi_decifratura = [];
        for (let i = 0; i < this.rounds; i++) {
            const nuova_chiave = this.chiave_round(chiave_round, i);
            chiave_round = nuova_chiave.binario;
            chiavi_decifratura.push(chiave_round);
        }
        chiavi_decifratura.reverse();
        // PERMUTO
        for (let i = 0; i < this.rounds; i++) {
            testo = this.round(testo, chiavi_decifratura[i], true);
            // SBOX
            this.sbox.genera_sbox(chiavi_decifratura[i]);
            testo = this.sbox.sostituzione_completa(testo, true);
        }
        // SBOX
        this.sbox.genera_sbox(chiavi[0]);
        testo = this.sbox.sostituzione_completa(testo, true);
        // rimuovo caratteri nulli
        testo = this.cripto.rimuovi_nulli(testo, null_bits);
        // XOR
        testo = this.xor(testo, chiavi[0]);
        // converto in formato normale
        testo = this.str._binario(testo)._utf8().string();
        return testo;
    }
    /**
     * chiavi round
     * @param {*} chiave in binario
     * @param {*} indice numero
     */
    chiave_round(chiave, indice) {
        chiave = this.str._binario(chiave).string();
        chiave = this.hash._256(chiave + indice, 'TEXT');
        chiave = this.hash._128(chiave, 1);
        const chiave_binaria = this.str._hex(chiave).binario_().string();
        return {
            hex: chiave,
            binario: chiave_binaria
        }
    }
    /**
     * esegue un round
     * @param {*} testo stringa binaria completa
     * @param {*} chiave 
     * @returns 
     */
    round(testo, chiave, reverse) {
        testo = this.cripto.blocks(testo, this.blocchi).blocks;
        const blocchi_cifrati = [];
        for (let i = 0; i < testo.length; i++) {
            const mixed_bits = this.cripto.permuta(testo[i], chiave, reverse);
            blocchi_cifrati.push(mixed_bits);
        }
        return blocchi_cifrati.join('');
    }
    /**
     * deriva una stringa binaria eseguendo delle xor
     * @param {*} chiave1 
     * @param {*} chiave2 
     * @returns 
     */
    xor(chiave1, chiave2) {
        let result = '';
        for (let i = 0; i < chiave1.length; i++) {
            result += this.logica.xor(chiave1[i], chiave2[i % chiave2.length]).string();
        }
        return result;
    }
}</code></pre>

            </div>
        </section>
        <nav>
            <button title="Genera Chiave" type="button" class="btn text apri_sezione nav" data-target="genera_chiave">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z" />
                </svg>
            </button>
            <button type="button" class="btn text apri_sezione nav" data-target="sezione_cifra">Cifra</button>
            <button type="button" class="btn text apri_sezione nav" data-target="sezione_decifra">Decifra</button>
            <button type="button" title="Codice Sorgente" class="btn text apri_sezione nav" data-target="sezione_codice_sorgente">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 7.5l3 2.25-3 2.25m4.5 0h3m-9 8.25h13.5A2.25 2.25 0 0021 18V6a2.25 2.25 0 00-2.25-2.25H5.25A2.25 2.25 0 003 6v12a2.25 2.25 0 002.25 2.25z" />
                </svg>
            </button>
        </nav>
    </div>
    <img src="../img/wallpaper/w1.jpg" alt="Immagine Sfondo" class="wallpaper">
</body>

</html>